<!DOCTYPE html>
<html>
    <head>
        <title>GenZWave | Choose your preferences</title>
        <link rel="stylesheet" type="text/css" href="css/listener.css" />
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700;900&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
        <script>
            function validatePref(){
                const selectedCheckboxes = [];
                const formIds = ["Genre", "Emotion", "Rhythm"];
                const msg1 = validateForm('Genre');
                const msg2 = validateForm('Emotion');
                const msg3 = validateForm('Rhythm');

                if (msg1 != "" || msg2 != "" || msg3 != "" ){
                    const finalMsg = `${msg1} ${msg2} ${msg3}`.trim()
                    window.alert(`Select at least one option for ${finalMsg}`);
                    event.preventDefault();
                }


                formIds.forEach(formId => {
                    const form = document.getElementById(formId);
                    const checkboxes = form.querySelectorAll('input[type="checkbox"]:checked');
                    checkboxes.forEach(checkbox => {
                        selectedCheckboxes.push(checkbox.name);
                    });  
                });

                console.log(selectedCheckboxes)

                fetch('/processPref', {
                    method: "POST",
                    body: JSON.stringify({ selectedCheckboxes }),
                    headers: {
                        "Content-Type": "application/json"
                    }
                })
                .then(response => response.json())
                .then(data => {
                    window.location.href = data.player;
                })
                .catch(error => {
                    console.log(error);
                })
            }

            function validateForm(formName) {
                var form = document.getElementById(formName);
                var checkboxes = form.querySelectorAll('input[type="checkbox"]');
                var isChecked = false;
                for (var i = 0; i < checkboxes.length; i++) {
                    if (checkboxes[i].checked) {
                        isChecked = true;
                        return "";
                    }
                }

                if (!isChecked) {
                    return formName

                }
            }
        </script>
    </head>

    <body>
        <nav class="navBar">
            <%- include("../partials/nav.ejs"); %>
        </nav>

        <div class="prefBox">
            <header style="font-weight: 700; font-size: larger; text-wrap: nowrap; margin: auto;">
                Hello <%=username%>, choose your music preferences
            </header>
            <div style="display:flex; flex-direction: row; text-wrap: nowrap;">
                <form action="/processPref" method="POST" id="Genre" name="Genre" style="margin: 20px;">
                    <h4>What genres?</h4>
                    <input type="checkbox" name="rap">
                    <label for="rap">Rap</label><br>
                    <input type="checkbox" name="pop">
                    <label for="pop">Pop</label><br>
                    <input type="checkbox"name="rb">
                    <label for="rb">R&B</label><br>
                </form>
                <form action="/processPref" method="POST" id="Emotion" name="Emotion" style="margin:20px;">
                    <h4>What kind of emotions?</h4>
                    <input type="checkbox" name="hype">
                    <label for="hype">Hype</label><br>
                    <input type="checkbox" name="sad">
                    <label for="sad">Sad</label><br>
                    <input type="checkbox" name="romance">
                    <label for="romance">Romantic</label><br>
                </form>
                <form action="/processPref" method="POST" id="Rhythm" name="Rhythm" style="margin:20px;">
                    <h4>What kind of rhythm?</h4>
                    <input type="checkbox" name="slow">
                    <label for="slow">Slow tempo</label><br>
                    <input type="checkbox" name="fast">
                    <label for="fast">Fast tempo</label><br>
                </form>
            </div>
            <a style="text-decoration: none; color: white;" >
                <button type="submit" onclick="validatePref();">Save</button>
            </a>
        </div>

    </body>
</html> 